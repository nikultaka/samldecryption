<?php

ini_set('display_errors', 0);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);    

session_start();

require_once dirname(__DIR__).'/_toolkit_loader.php';

require_once 'settings.php';

$auth = new OneLogin_Saml2_Auth($settingsInfo);

$samlResponse = 'PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0
YzpTQU1MOjIuMDphc3NlcnRpb24iIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6
bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIElEPSJwZnhkNzUxM2VkNy00
ZDM4LWY5MjEtYzVmZS02ZWFiNGE1MjFmZDQiIFZlcnNpb249IjIuMCIgSXNz
dWVJbnN0YW50PSIyMDIxLTA1LTE5VDE4OjUxOjM2WiIgRGVzdGluYXRpb249
Imh0dHA6Ly9sb2NhbGhvc3QvcGhwLXNhbWwtbWFzdGVyL2RlbW8xL2luZGV4
LnBocCIgSW5SZXNwb25zZVRvPSJPTkVMT0dJTl9lYWM2NjFjZmRkMWUxNjc3
YTEyZDBhZjY3OTkwNzMyMzdhMjY1ZGUwIj48c2FtbDpJc3N1ZXI+aHR0cHM6
Ly9hcHAub25lbG9naW4uY29tL3NhbWwvbWV0YWRhdGEvNjA2NmQyM2ItOTBi
OC00Mzc4LWJiOWQtOWNjMzAzNzI3MmMxPC9zYW1sOklzc3Vlcj48ZHM6U2ln
bmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3ht
bGRzaWcjIj48ZHM6U2lnbmVkSW5mbz48ZHM6Q2Fub25pY2FsaXphdGlvbk1l
dGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1s
LWV4Yy1jMTRuIyIvPjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJo
dHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz48
ZHM6UmVmZXJlbmNlIFVSST0iI3BmeGQ3NTEzZWQ3LTRkMzgtZjkyMS1jNWZl
LTZlYWI0YTUyMWZkNCI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBB
bGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNl
bnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09
Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwv
ZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0
cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGln
ZXN0VmFsdWU+REpYT2kwUXhEa1ZSd084YVh0SE51eG1zc3hjPTwvZHM6RGln
ZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpT
aWduYXR1cmVWYWx1ZT5ROXhrNjRzYUZOQkVsa0hkbmZUQ0JYZXpNcmFOUksv
YWF3dXJ5OW1YR2lhTXlRbEF2YWI0R1NhZ1JFSmFxblhCUkE4WlNUTjJkV3VM
TkpzVmRFSlVncFdBWkF3b2l4M1BBQjZBMC9vRTNwbHhnRE9IZE5kOU1BZE0y
UmlKM2RjVnZjT1RGbTBtVnVuRW1tbEVSYU85QkZzbkxjS3ZWMU9MRlI4cmxP
QjRrOGlleXBwSS95bGRzUTcyTzRPdXJHUHdQb09YLzExa2ZSUnYyMmVFNEkx
azJjZkpEVkxmcTZwdVdmWjRzTDhsKzIwckp5bm1IY21Tc0t5bjFWM2d0a2Rh
NHpQdWhpSThKMm11WSsrd3RBMHBQV3pwMHpVeE1zUHZmNmdaSzJRdk5US3Vh
cE5EZWtMcDNwQTN2ODB3SFNvdmN5dGpHY2pZRk5WWkNzbmVpQXdrckE9PTwv
ZHM6U2lnbmF0dXJlVmFsdWU+PGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxk
czpYNTA5Q2VydGlmaWNhdGU+TUlJRDZ6Q0NBdE9nQXdJQkFnSVVTVHRpSzFB
SE9ORm05TmxKNDRwcExCaTRUeUF3RFFZSktvWklodmNOQVFFRkJRQXdTakVW
TUJNR0ExVUVDZ3dNY0dGc2JHRmthWFZ0YUhWaU1SVXdFd1lEVlFRTERBeFBi
bVZNYjJkcGJpQkpaRkF4R2pBWUJnTlZCQU1NRVU5dVpVeHZaMmx1SUVGalky
OTFiblFnTUI0WERUSXhNRFF4T1RFd016a3dPRm9YRFRJMk1EUXhPVEV3TXpr
d09Gb3dTakVWTUJNR0ExVUVDZ3dNY0dGc2JHRmthWFZ0YUhWaU1SVXdFd1lE
VlFRTERBeFBibVZNYjJkcGJpQkpaRkF4R2pBWUJnTlZCQU1NRVU5dVpVeHZa
Mmx1SUVGalkyOTFiblFnTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FR
OEFNSUlCQ2dLQ0FRRUF1V1RXeWMxb1k5cUMrM0pnTUVDQ0x1dVZUWEpzell5
WHBsVlJzV2htcGRabk1SUUh5eUNLQ0hHM3NQbm0zUkozaGNVT2FEWFAyVXJK
WkhDRjAxd1BjdzV3QUk2Q0RIb2ppYllzd05icmpUZU5KOFo4Tjc3Rk1MRlVI
Rms0L2FDVHN0R3FkM2VMeUlIQm1DbTlKa05nd1RVNXlOUEYzL2daZU40K2l4
cnVFTzA4TGVlVmdSVWZOcCtmOVpaRmdNOXRScnlxaHlDUmJWb1BzYzhEVUtJ
UEVWaTZodzZnWGVpUXRaSzM0Mm5nWEpSZzdjOC9pZ0VycXJiM1ZmUGRCeTJH
VjI5ampmRXFnZnJEKzJDazdzOHRzSU0ycm1GZWZXTGZObEtqV1BkRlhiYklF
bU5MN2p0dHhYTXNndVQ1c0lFQzJvVUNYWkZ5citJSVJaODdJdHBOU3dJREFR
QUJvNEhJTUlIRk1Bd0dBMVVkRXdFQi93UUNNQUF3SFFZRFZSME9CQllFRklX
b3g1ZkFjVWRIeUhCenZlU25POVYxcFFjaU1JR0ZCZ05WSFNNRWZqQjhnQlNG
cU1lWHdIRkhSOGh3Yzcza3B6dlZkYVVISXFGT3BFd3dTakVWTUJNR0ExVUVD
Z3dNY0dGc2JHRmthWFZ0YUhWaU1SVXdFd1lEVlFRTERBeFBibVZNYjJkcGJp
QkpaRkF4R2pBWUJnTlZCQU1NRVU5dVpVeHZaMmx1SUVGalkyOTFiblFnZ2hS
Sk8ySXJVQWM0MFdiMDJVbmppbWtzR0xoUElEQU9CZ05WSFE4QkFmOEVCQU1D
QjRBd0RRWUpLb1pJaHZjTkFRRUZCUUFEZ2dFQkFFSGhSYUp2UFRlcEVCWkJh
WnhOYTJjRXhvbFE1MktTdVZKbXcxRjJGSDlIaWF3YXlFMEJHR3dvcmNHT09p
cFBIZ1VIb20xUmhKNCttbFpocG1DelNVQTVnaEpOVmZoNGxWYUErSHh4bDBR
VDhVRFNNM1NXams4dVBsZTV6Sk0xREVzTEFqQmxmNDhXUTRIeUIxdXRNNWdE
b2QzaEF6TjR0aktObkZ6QmNUbFc4RGM5V2lBdmlBWTI0VmNrYXV1R3cwVlc5
bURWR0FQREFqcHVWNGtFK25MdmdUTDFWbXNCV3V3UVNmMjZ3N0pNZ2JwelFu
Mkw0QXU4R3h6cDgvVzUxcXp5RWFyQS9XdmpGT3NCbmFORWRRUElnTHJGRWdj
ZEZCSVpVUnlVNng5MENUY0VOR25wTU5zMHhNRk05WnBTZkZmSURCTFRvc3ha
TkNxalcvaEszL1U9PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0
YT48L2RzOktleUluZm8+PC9kczpTaWduYXR1cmU+PHNhbWxwOlN0YXR1cz48
c2FtbHA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNB
TUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PC9zYW1scDpTdGF0dXM+PHNhbWw6
RW5jcnlwdGVkQXNzZXJ0aW9uPjx4ZW5jOkVuY3J5cHRlZERhdGEgeG1sbnM6
eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIiBUeXBl
PSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNFbGVtZW50Ij48
eGVuYzpFbmNyeXB0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53
My5vcmcvMjAwMS8wNC94bWxlbmMjdHJpcGxlZGVzLWNiYyIvPjxkczpLZXlJ
bmZvIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRz
aWcjIj48eGVuYzpFbmNyeXB0ZWRLZXk+PHhlbmM6RW5jcnlwdGlvbk1ldGhv
ZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5j
I3JzYS0xXzUiLz48eGVuYzpDaXBoZXJEYXRhPjx4ZW5jOkNpcGhlclZhbHVl
PlRDNml2UHRzWDJGZ1BydUxEcnc2emNIQ08raEhtNWhyTmtNdkErZjNXdjRl
NE1tTUZud0VybExJL3pYV0c2NnkKYnZoQ0JkSmdlZ3c5SHh0dlNWdWZFVnVB
MFVZTkt3QWVrMkFxNURvZ3FwV3lIN1NqRjE1RmZkSTBwVUFYK0JadApaMmE3
UTlzK2h6SjVXRHIzZ1RMaUx1VFd6enhjUWdlM0tDZmNUQk9ZRmRzPTwveGVu
YzpDaXBoZXJWYWx1ZT48L3hlbmM6Q2lwaGVyRGF0YT48L3hlbmM6RW5jcnlw
dGVkS2V5PjwvZHM6S2V5SW5mbz48eGVuYzpDaXBoZXJEYXRhPjx4ZW5jOkNp
cGhlclZhbHVlPnd4dkVzelk1aUlTWWVBM1VSNlgzOGd2TytIaDRhUE96WXhT
OUNCR3h6b2k1a01FS2R5TVNPbTNxanh0QnkyZ0sKV3daWHlvRk5hZU00enIr
aVpJWmlMMTlPK3A4eVkrdG10TCtQMjNSYklFZEdZYTRwc00vM2NMS1N1dTAy
blJhcwpoUU40ZTRQYnNzMXJtOEhQSXhTSjRzNmY2dUlhdUc3aFI4QW1zQlFO
U1RRVTIyR1ZTQ3JUZzQ3Q2hYZzdKOVJsCmtzS0htbldWMHcyUVJFUW5KdzRk
VFp2aHp5UERicmQ2TE94NUhOU3Fvdm53b0NGODBmUElUTmJ4a0pvK3d0TmMK
MmdHRkhvbHROSlRiRmYyMmgvNjJwNzloZXJ6dXBvWmFNbWFVNnovNlFtRGtT
T0tOWGo0SUZaSDB3NitDUnl4MgpFTjdYU3VPSUlPV0tzRUdlcG1vNnp0c1ha
YkNWeDhTTytjMFYxdktDd01IWDJMT1JMcTdaTFZod0JqdUxVSmVFClVpWjdR
bWhaZnhWMWRKVlJUaHdZWS9DY2NrdHhrMFJhRHNGZXVZV2pZWHovaEtzY3RX
ZS9MRm9CdFpXWGlXY0MKMVhRUk5PTWxnV2hPaElnRVVIbDZjd0RDdGl0RWx6
aVc0TndSRHBERjU1RjhJUlBGM1E5NmdtVVFTakVESUhNTwpTbGNRb29HNGdT
ZHZqaDNzWVdsMEN4eWNnNUJBbENCRzI3MGs5Z1dOZW5kNk1lcUtUR3hCWHlj
bHJWK25pOHlDCit3NWVjNFg4a1pObkNEckJseDlESHFKc211dzVwR2pTSWpC
OTQvQmwwK2pVQVVTQmhFUGVORE1VT0NQOVplSTcKS2hlMFEvN0kvRURWVWw5
VzlieEsrdWJmOHRSZ0RNTCtFUE40UExXWmtkVXR2MkJPalluNUFiMlVudDkv
aVhrOQpNbDdQZml3SlBSd0NiUTVsYlBvbTJoQXVsQVBKR21Qb3F3T1VRUEFo
T2laQkRIM3ZISkRYR2hRbXBMSUI0M0J5CmhLaDhjWll6aFRvaThTZ1ZUczc2
d3cxQWl3WW5NVUJra3VRZnFZQnFHTnd3ZjZUalRuTllwYjZ3UzNkOXBWSHQK
N0NUbThkcjZ1LzFkSXJ6bnlmU1VQZWw0RUZFOFo1Qy9VVWJhOUdSS1MybnJ2
enRBV3B4c3M4RlVNdWk2ZklBSgp5TzRBM2RmaVpYUW5YUmd4RzRGVkd5TGhQ
ampwa2tySVRGblovSlVweWRuVkQxU0h4RjRuRXd1MWc3Ylg5bnczCktIUXUy
YnF4Rk1sT2dheFZOVTlBK2hFUHEvc28rZGtXZEd1a2JiT3NMNm1tZTNBdEtY
bmZwcnZjckJUc0VUVlEKNjVIcUQ3MENTRkpwMVFBUUlUaWxHZlpvUURGWVg4
RkNIbllaaEVXV09NMmVESXVZUGVGY1YxY3RucWR0NWxMVQpMeWVHUncvNUtV
cm9uWjk3YklnUXJwdU9GU1MyaSticWFVaWx0R1Z1cmJpOFMvWjJaenBlRFlE
dGRSTi85MFhyCmtNbzhpa0RVTkJDbWtjc1F1S2NHVms0Vm9FSFVLUndwdkNL
Y2ZaWkJhK2xJcmhCQ09oNmRiWW1zOUpYOGZLa1kKRkVxOWpsSFZYOUFYNWN6
eER1Q0hrZzAwSVB1QVl0K3NWbkhkd2dvckNiSnVydUVWQ0F3aEhndm0zTmtB
TmdrMgpxdUJIS21TNUJmc0IybzJhTi92cHdvKzNpZjgvWG5WWE1yZHhlb2Fv
SWUxTEJBdGE3MnZqdlR3cjIrelJGOE5aCm44cGxzN2VSRU8vQXMwV2JRU3Fu
UDV2MGJlQmZIWTA3S3dxcHowdzVKQTlzR2tyN01JSXY2akIvaUQ2S3p0TmoK
RWpCUVBXMTRwRElhcWN0STBHaDROTTZNSGRHYmlzMFp0dU5mNUR5NUFkN0JC
K2NqNUZPU2w3cG16M3FVN0MrZwp3aHNuWVJZUTBzNEx6Ky9UTDd4QXZXZGtT
TlplZ09pNEtlVk5IWEhMSUx5Q2NvcHp1Ty9FRFZjY0hyeWRnZ3ZuCmU0OUxo
RjM0dlZ5QTUrMXJhV1BxSjZReDFTdnVnNEVxYTVvemFmMXZpNG9qanNLczl2
a0xSRnJLWjBKY3FBOVUKSUNsT05vY0w5eHZKenhFYjVielNBeUJ2OGtnODVm
b0N0ak9OQTVFUU1LdDRrSFZ4SGk3NzhlVzBNdmdTQjNabgoxQVpBMDk3ekhk
M0VuRkk0am1kVWUrNGtESzBoWk10MHk1NWV6Z3FzRHZxV1dhSHZSMmhLQjBE
ejE0a0hBK3BKClo3ZFgrbCtqV0tXUlVRTzBTMmxrWWtlUTZJcEhUZE42dDFT
K1kzbURSN1JvVjc5S3F0ZjY1NmluWEZ5MEZYZzQKM1JXM3NhdTFkbEIwMm1k
cE5nc0toU0hUSHZYZnBhZU5UVkc3UFNJQ3FOZXlsenRNVDAydlg1dGxIVFkx
a3JBMApKODFnK1hKYWVLOD08L3hlbmM6Q2lwaGVyVmFsdWU+PC94ZW5jOkNp
cGhlckRhdGE+PC94ZW5jOkVuY3J5cHRlZERhdGE+PC9zYW1sOkVuY3J5cHRl
ZEFzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPgoK';

$auth->processResponse('',$samlResponse);

$errors = $auth->getErrors();

if (!empty($errors)) {
    echo '<p>',implode(', ', $errors),'</p>';
    if ($auth->getSettings()->isDebugActive()) {
        echo '<p>'.$auth->getLastErrorReason().'</p>';
    }
}

if (!$auth->isAuthenticated()) {
    echo "<p>Not authenticated</p>";
    exit();
}

$_SESSION['samlUserdata'] = $auth->getAttributes();
$_SESSION['samlNameId'] = $auth->getNameId();
$_SESSION['samlNameIdFormat'] = $auth->getNameIdFormat();
$_SESSION['samlNameIdNameQualifier'] = $auth->getNameIdNameQualifier();
$_SESSION['samlNameIdSPNameQualifier'] = $auth->getNameIdSPNameQualifier();
$_SESSION['samlSessionIndex'] = $auth->getSessionIndex();

echo '<pre>'; 
print_r($_SESSION); 
exit;